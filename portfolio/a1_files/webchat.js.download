!function(t){var e={};function o(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){"use strict";o.r(e);const n=function(t){if(!URL)throw new Error("URL not supported on legacy browsers");return new URL(location.href).searchParams.get(t)},i=function(t,e){if(!URL)throw new Error("URL not supported on legacy browsers");const o=new URL(location.href);o.searchParams.set(t,e),history.replaceState(null,"",o.toString())},s="knock_schedule_tour",r="knock_availability",a="knock_text_message",l="real_page_floor_plan_code",c="link",d="integration",_="click_button",h="button_bar",u=(t,e,o=5e3)=>{let s=n(t);i(t,e),setTimeout((function(){s?i(t,s):function(t){i(t,void 0)}(t)}),o)},p=()=>{document.getElementById("rp-modal-container").style.zIndex="10000",document.getElementsByClassName("chatprompt")[0].style.zIndex="9999"},g="https://d11lfsq85csbzj.cloudfront.net/",m="https://resbot-server-prod.herokuapp.com/",b="https://s3.amazonaws.com/respage-review-solicitation/",f="https://app.respage.com/",w="https://rp-webchat-client.netlify.app/",I=!0,v="https://d1fl2ex0qrqjwz.cloudfront.net/text-us.js",S="https://d1fl2ex0qrqjwz.cloudfront.net/text-us.css",E="https://d1fl2ex0qrqjwz.cloudfront.net/nudge.js",y="https://d1fl2ex0qrqjwz.cloudfront.net/nudge.css",C="https://d1fl2ex0qrqjwz.cloudfront.net/reviewbot.js",T="https://d1fl2ex0qrqjwz.cloudfront.net/reviewbot.css",O="https://respage-rs-prod.herokuapp.com",k="https://respage-rs-prod.herokuapp.com/solicitor",A=t=>"rp_storage_local_"+t,N=t=>"rp_storage_session_"+t,R=function(){try{return window.localStorage.setItem("__test__","__test__"),window.localStorage.removeItem("__test__"),!0}catch(t){return!1}}(),M=R,x={set:function(t,e){try{R?window.localStorage.setItem(t,JSON.stringify(e)):window[A(t)]=JSON.stringify(e)}catch(t){}return e},get:function(t){try{return R?JSON.parse(window.localStorage.getItem(t)):JSON.parse(window[A(t)])}catch(t){return}},remove:function(t){if(R)return window.localStorage.removeItem(t);delete window[A(t)]}},B={set:function(t,e){return R?window.sessionStorage.setItem(t,JSON.stringify(e)):window[N(t)]=JSON.stringify(e),e},get:function(t){try{return R?JSON.parse(window.sessionStorage.getItem(t)):JSON.parse(window[N(t)])}catch(t){return}},remove:function(t){if(R)return window.sessionStorage.removeItem(t);delete window[N(t)]}},P=function(t){if(!t.url)throw new Error("[RESBOT][AJAX] Fatal Error: URL not provided to AJAX request");let e,o={url:t.url,method:t.method||"GET",headers:t.headers||null,onSuccess:t.onSuccess||function(){},onError:t.onError||function(){},json:t.json||!1,body:t.body||void 0,qs:t.qs||null,retries:t.retries||3},n=o.retries;o.qs&&(o.url+="?"+Object.keys(o.qs).map(t=>`${t}=${encodeURIComponent(o.qs[t])}`).join("&")),function i(){let s=new XMLHttpRequest;s.onload=function(){if(o.json)try{e=JSON.parse(s.responseText)}catch(t){e=s.responseText}else e=s.responseText;s.status>=400?o.onError(e):(I&&console.log("[RESBOT][AJAX]",e),o.onSuccess(e))},s.onerror=function(){if(n--,n>0)setTimeout(i,250);else{if(o.json)try{e=JSON.parse(s.responseText)}catch(t){e=s.responseText}I&&console.log("[RESBOT][AJAX]",e),o.onError(e)}};try{s.open(o.method,o.url,!0),o.json&&s.setRequestHeader("Content-Type","application/json"),o.headers&&Object.keys(o.headers).forEach(t=>s.setRequestHeader(t,o.headers[t])),void 0!==o.body?o.json?s.send(JSON.stringify(o.body)):s.send(o.body):s.send()}catch(e){throw console.log(e),"[RESBOT][AJAX] Fatal Error (url: "+t.url+"): "+e.message}}()},U=function(t){return new Promise((e,o)=>P(Object.assign(Object.assign({},t),{onSuccess:t=>e((null==t?void 0:t.data)?t.data:t),onError:t=>o((null==t?void 0:t.error)?t.error:t)})))},D=function(t,e){try{const o=B.get(t);return o?(console.log(`got ${t} from cache`,o),Promise.resolve(o)):U(e)}catch(t){return console.error(t),null}},L=function(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/iPhone|iPod/i)||navigator.userAgent.match(/Opera Mini/i)||navigator.userAgent.match(/IEMobile/i)||window.innerWidth<=768},j="__respage_chatbot_loaded__",q="__respage_chatbot_direct_embed__",z="__respage_chatbot_location__",G="__respage_chatbot_ue__",J="__respage_chatbot_up__",$="__respage_chatbot_pd__",F="__respage_chatbot_reservation_mode__",H="__respage_chatbot_reservation_resource_id__",X="__respage_chatbot_initial_locale__",W=function(t,e,o){let n="";if(o){let t=new Date;t.setTime(t.getTime()+60*o*1e3),n="; expires="+t.toUTCString()}else"expired"===o&&(n="; expires="+new Date(0).toUTCString());document.cookie=t+"="+JSON.stringify(e)+n+"; path=/"},V=function(t){if(!navigator.cookieEnabled)return;t+="=";let e=decodeURIComponent(document.cookie).split(";");for(let o=0;o<e.length;o++){let n=e[o];for(;" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return JSON.parse(n.substring(t.length,n.length))}},K=function(){switch(navigator.language.slice(0,2)){case"en":return"en-US";case"es":return"es-MX"}};let Y,Z,Q=!1,tt=window.location.href;const et=function(t,e){nt(t,e),it(t,e,[st,rt,at])},ot=function(t){let e=Date.now();t(Math.floor(Math.random()*e).toString(36)+Math.abs(Math.floor(Math.random()*e)^Date.now()).toString(36))},nt=function(t,e){Q||(window.addEventListener("click",(function(){tt!==window.location.href&&(tt=window.location.href,et(t,e))})),Q=!0)},it=function(t,e,o){let n,i={campaign_id:t,bot_session_id:e},s=o.shift();if(navigator.cookieEnabled){if(n=V(Y),!(n&&n.type&&n.id))return ot((function(t){n||(n={}),n.type="cookie",n.id=t,i.visit=n,W(Y,n,120),s(i,o)}));W(Y,n,120),i.visit=n,s(i,o)}},st=function(t,e){let o,n=e.shift();if(M){if(o=x.get(Z),!o)return ot((function(i){o={},o.type="cookie",o.id=i,t.visitor=o,x.set(Z,o),n(t,e)}));t.visitor=o,n(t,e)}},rt=function(t,e){let o=e.shift(),n={};n.is_mobile=L(),n.language=K(),n.timezone_offset=(new Date).getTimezoneOffset(),n.user_agent=navigator.userAgent,t.visitor.data=n,n={},n.campaign_id=t.campaign_id,n.bot_session_id=t.bot_session_id,n.referrer=t.visit.referrer,n.url=window.location.href,n.timestamp=Math.floor(Date.now()/1e3),t.visit.data=n,o(t,e)},at=function(t){return P({url:f+"api/chatbot/track-visit",method:"POST",qs:{visitInfo:encodeURIComponent(JSON.stringify(t)),"respage-token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE0Njg2MTI0MDksImV4cCI6NDYyMjIxMjQwOX0.rm4NjCU242EB1lERBmG07G6OsFFToiKmQvNFgmdMZyE"},onSuccess:()=>"lol"})},lt=function(t){return parseInt(t,10)-(new Date).getTime()<0},ct=function(t,e=new Date){return new Date(e.getTime()+1e3*parseInt(t,10)).getTime()},dt=()=>window[q],_t="auto",ht="auto",ut=!1,pt=!1,gt=!1,mt=0,bt=!1,ft=!1,wt=!1,It=!0;class vt{constructor(t=!1,e=!1){this.settings={},this.DID_OPEN=t,this.IS_OPEN=e}load(t){this.chatPromptEl=document.querySelector(".chatprompt"),this.createModal(t),"complete"===document.readyState?(document.body.appendChild(this.modalContainer),this.settings.loadCallback()):window.addEventListener("load",function(){document.body.appendChild(this.modalContainer),this.settings.loadCallback()}.bind(this),!1),window.addEventListener("message",t=>{if(t.data&&t.data.event){const e=t.data.event;"resbotClose"===e?this.close():"resbotInitialized"===e&&this._eventResbotInitialized(t.data.detail)}})}createModal(t){this.settings.width=t.width||_t,this.settings.height=t.height||ht,this.settings.lock=t.lock||ut,this.settings.hideClose=t.hideClose||pt,this.settings.draggable=t.draggable||gt,this.settings.closeAfter=t.closeAfter||mt,this.settings.closeCallback=t.closeCallback||ft,this.settings.openCallback=t.openCallback||wt,this.settings.loadCallback=t.loadCallback||bt,this.settings.hideOverlay=t.hideOverlay||It,this.modalContainer=document.createElement("div"),this.modalHeader=document.createElement("div"),this.modalContainer.setAttribute("id","rp-modal-container"),this.modalContainer.setAttribute("aria-hidden","true"),this.modalHeader.setAttribute("id","rp-modal-header"),this.modalContainer.appendChild(this.modalHeader),this.modalContainer.style.display="none";const e=L()?"mobile":"desktop";this.modalContainer.classList.add(e),dt()&&(this.modalContainer.style["z-index"]=0)}appendModalContent(t){this.modalContent=document.createElement("div"),this.modalContent.setAttribute("id","rp-modal-content"),this.modalContent.innerHTML=t,this.modalContainer.appendChild(this.modalContent)}open(t=!1){"true"!==this.chatPromptEl.getAttribute("aria-expanded")?(B.set(this.DID_OPEN,!0),B.set(this.IS_OPEN,!0),this.modalContainer.style.display="block",this.modalContent&&(this.modalContent.style.display="block"),this.modalContainer.setAttribute("aria-hidden",String(!1)),this.chatPromptEl.setAttribute("aria-expanded",String(!0)),this.chatPromptEl.setAttribute("tabindex",String(-1)),this.settings.openCallback&&this.settings.openCallback()):t||this.close()}close(){this.modalContent.style.display="none",this.modalContainer.style.display="none",this.modalContent.setAttribute("aria-hidden",String(!0)),this.modalContainer.setAttribute("aria-hidden",String(!0)),this.chatPromptEl.setAttribute("aria-expanded",String(!1)),this.chatPromptEl.setAttribute("tabindex",String(0)),B.set(this.IS_OPEN,""),this.settings.closeCallback&&(this.settings.closeCallback(),this.chatPromptEl.focus())}_eventResbotInitialized(t){this.chatPromptEl.style.display="block",this.chatPromptEl.setAttribute("aria-hidden",String(!1))}}const St=function(t){return t&&!0!==t&&!isNaN(+t)},Et=function(t){return t&&"string"==typeof t&&isNaN(+t)},yt=(t,e="*",o="respagebot")=>{const n=document.getElementById(o);n?n.contentWindow.postMessage(t,e):console.log("[IFrame postMessage] could not find iFrame of id: "+o)},Ct=(t,e)=>{var o;return!!(null===(o=null==t?void 0:t.subscribed_features)||void 0===o?void 0:o.includes(e))};var Tt;!function(t){t.Chatbot="Chatbot",t.ReviewBot="Review Solicitation",t.AmenityBooking="Amenity Booking",t.ResMate="AI Leasing Agent"}(Tt||(Tt={}));const Ot=(t,e)=>{const o=document.createElement("link");o.media="print",o.rel="stylesheet",o.href=t,o.onload=()=>{o.media="all",e&&e()},document.querySelector("head").appendChild(o)},kt=(t,e)=>{let o=document.createElement("script");o.src=t,o.defer=!0,e&&(o.onload=e),document.querySelector("body").appendChild(o)},At=t=>D(t+"~resbot_settings",{method:"GET",url:g+t+"~settings",json:!0}).then(e=>(I&&console.log("got settings from remote",e),e&&B.set(t+"~resbot_settings",e))).catch(e=>(e.name=t+": Chatbot Settings Error",console.error(e),null));let Nt=(t=21)=>{let e="",o=crypto.getRandomValues(new Uint8Array(t));for(;t--;){let n=63&o[t];e+=n<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():n<63?"_":"-"}return e};const Rt=function(t){const e=document.createElement("style");e.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(e)};class Mt{constructor(t,e){this._campaignId=t,this._botUrl=w,this._botServerUrl=m,this._apiUrl=m,this._modal=new vt,this._textUsModal=null,this._nudge=!!e.nudge,this._textUs=!!e.textUs,this._sleepSchedule=!!e.sleepSchedule,this._sessionId=null,this._storedMessage=null,this._restarting=!1,this._iframeUrl=!1,this.DID_OPEN=this._prependCampaignId("resbot_didOpen"),this.IS_OPEN=this._prependCampaignId("resbot_isOpen"),this.SESSION_ID=this._prependCampaignId("resbot_sessionId"),this.OLD_SESSION_ID=this._prependCampaignId("resbot_oldSessionId"),this.SESSION_EXPIRES=this._prependCampaignId("resbot_sessionExpires"),this.LOCALE=this._prependCampaignId("resbot_locale"),this.CHATBOT_SETTING=this._prependCampaignId("resbot_settings"),this.EXPERIMENT_ID=this._prependCampaignId("resbot_experimentId"),this.INITIAL_MESSAGE_POSTED=this._prependCampaignId("resbot_initialMessagePosted"),this.WAITING_TIMEOUT_TIMESTAMP=this._prependCampaignId("resbot_waitingTimeoutTimestamp"),this.PORTAL_ACCESS_KEY=this._prependCampaignId("respage_rs_parent~portal_accessed"),this.REVIEW_SOLICITATION_NEVER_AGAIN=this._prependCampaignId("respage_rs_parent~neveragain"),this.RS_NO_EMBED_KEY=this._prependCampaignId("respage_rs_parent~no_embed"),this._botUrl=w,this._botServerUrl=m,this._modal=new vt(this.DID_OPEN,this.IS_OPEN),this._experiment=null,this._waitingTimeout=null,this._agentConnected=!1,function(t){if(Y=t+"~resbot_visitId",Z=t+"~resbot_visitorId",!navigator.cookieEnabled)return;let e=V(Y);e||(e={}),e.referrer||"string"==typeof e.referrer||(e.referrer=document.referrer,W(Y,e,120))}(this._campaignId),null===performance||void 0===performance||performance.mark("resbot_botInitMeasureStart")}load(t){return window[j]=!1,this._campaignId?this._isResidentUser()&&!this._isReviewSolicitationOptedOut()?(I&&console.log("[RESBOT][INIT] Resident user. Exiting..."),null):(t||(window[X]?(this._locale=window[X],window[X]=null):this._locale=B.get(this.LOCALE)||K()||"en-US"),I&&console.log("[RESBOT][INIT] Starting up"),"complete"===document.readyState&&(I&&console.log(this),this._getSettingsAndInitialize()),window.addEventListener("load",()=>{I&&console.log(this),this._getSettingsAndInitialize()}),void window.addEventListener("message",t=>{if(I&&console.log("[RESBOT] event",t),t.data&&t.data.event){const e=t.data.event;"resbotInitialized"===e?this._eventResbotInitialized(t.data.detail):"appBootstrapped"===e?this._eventAppBootstrapped():"resbotMessage"===e?this._eventResbotMessage(t.data.detail):"resbotSessionExpired"===e?this._eventResbotSessionExpired():"resbotWaitingForAgent"===e?this._eventResbotWaitingForAgent():"resbotConnectedToAgent"===e?this._eventResbotConnectedToAgent():"resbotConnectedToBot"===e?this._eventResbotConnectedToBot():"resbotCustomButton"===e?this._eventResbotCustomButton(t.data.detail):"resbotInitialMessagePosted"===e?this._eventResbotInitialMessagePosted(t.data.detail):"resbotSendGoogleAnalyticsEvent"===e?this._eventResbotSendGoogleAnalyticsEvent(t.data.detail):"resbotOpenModal"===e&&this._eventResbotOpenModal()}})):null}_isResidentUser(){return!!x.get(this.PORTAL_ACCESS_KEY)}_isReviewSolicitationOptedOut(){return!!x.get(this.REVIEW_SOLICITATION_NEVER_AGAIN)}_getSettingsAndInitialize(){return At(this._campaignId).then(t=>{this._config=function(t,e){let o=/^#[0-9A-Fa-f]{6}$/,n=/<Code>NoSuchKey<\/Code>/,i={},s="";if(I&&console.log("[RESBOT][SETTINGS_VALIDATION] Validating Settings"),!e)throw new Error("No config data returned");if("string"==typeof e){if(n.test(e))throw new Error("No Respage Chatbot settings found");try{e=JSON.parse(e)}catch(t){throw new Error("Unable to parse settings")}}if("error"===e.result)throw new Error(e.message);if(e.noEmbed)throw new Error("Respage Chatbot: noEmbed");if(i.bot_button_color=e.bot_button_color||e.theme_primary_color||"#4b80c2",i.bot_button_accent_color=e.bot_button_accent_color||"#797878",i.opt_in_cta_text=e.opt_in_cta_text||"Please provide your first name, last name, email address, and a phone number to schedule a tour.",i.bot_button_text=e.bot_button_text,i.bot_icon_url=e.bot_icon_url,i.bot_avatar_url=e.bot_avatar_url||"https://respage-static.s3.amazonaws.com/images/chatbot-icon.png",i.bot_input_prompt=e.bot_input_prompt,i.bot_name=e.bot_name,i.bot_selfstart_timeout=e.bot_selfstart_timeout,i.bot_height=e.bot_height,i.bot_width=e.bot_width,i.campaign_id=e.campaign_id,i.client_id=e.client_id,i.bot_persona=e.bot_persona,i.on_off_schedule=e.on_off_schedule,i.campaign_timezone=e.campaign_timezone,i.leasing_application_url=e.leasing_application_url,i.subscribed_features=e.subscribed_features,i.offer_amenity_booking=e.offer_amenity_booking,i.bot_selfstart=!!e.bot_selfstart,i.bot_enable_spanish=!!e.bot_enable_spanish,i.bot_v3_plus=!!e.bot_v3_plus,i.human_handoff=e.human_handoff,i.human_handoff_waiting_timeout=e.human_handoff_waiting_timeout,i.custom_buttons=e.custom_buttons,i.custom_announcement=e.custom_announcement,i.override_initial_quick_replies=!!e.override_initial_quick_replies,i.hide_resident_button=!!e.hide_resident_button,i.url_blocked_list=e.url_blocked_list||[],i.custom_css=e.custom_css,i.whitelabel_data=e.whiteLabelData||{},i.campaign_id&&St(i.campaign_id)||(s+="<li>Invalid campaign_id: "+i.campaign_id+" (must be number)</li>"),i.client_id&&St(i.client_id)||(s+="<li>Invalid client_id: "+i.client_id+" (must be number)</li>"),(!i.subscribed_features||i.subscribed_features.indexOf("Chatbot")>-1)&&(i.bot_button_color&&o.test(i.bot_button_color)||(s+="<li>Invalid bot_button_color: "+i.bot_button_color+" (must be valid 6 digit hex code)</li>"),i.bot_button_text&&Et(i.bot_button_text)||(s+="<li>Invalid bot_button_text: "+i.bot_button_text+" (must be string)</li>"),i.bot_input_prompt&&Et(i.bot_input_prompt)||(s+="<li>Invalid bot_input_prompt: "+i.bot_input_prompt+" (must be string)</li>"),i.bot_name&&Et(i.bot_name)||(s+="<li>Invalid bot_name: "+i.bot_name+" (must be string)</li>"),!i.bot_selfstart||i.bot_selfstart_timeout&&St(i.bot_selfstart_timeout)||(s+="<li>Invalid bot_selfstart_timeout: "+i.bot_selfstart_timeout+" (must be number)"),i.bot_height&&St(i.bot_height)||(s+="<li>Invalid bot_height: "+i.bot_height+" (must be number)</li>"),i.bot_width&&St(i.bot_width)||(s+="<li>Invalid bot_width: "+i.bot_width+" (must be number)</li>"),(!i.bot_persona||"funny"!==i.bot_persona&&"serious"!==i.bot_persona)&&(s+="<li>Invalid bot_persona: "+i.bot_persona+" (must be 'funny' or 'serious')</li>")),s)throw new Error(JSON.stringify(s));return i}(this._campaignId,t),this._config&&this._start()})}_trimUrl(t){return t=(t=t.replace(/^https?:\/\//,"")).replace(/^www./,"")}_start(){const t=t=>{const e=this._trimUrl(document.location.href),o=this._config.leasing_application_url?this._trimUrl(this._config.leasing_application_url):null,i=-1!==e.indexOf(o),s=(this._config.url_blocked_list||[]).some(t=>-1!==e.indexOf(t));if(t||i||s)return void console.warn("Chatbot prevented from initializing",{isSleeping:t,isLeasingApplicationPage:i,isBlockedUrl:s});const r=n("rp_conversation_id"),a=n("rp_conversation_expires");r&&a&&!lt(+a)&&(x.set(this.SESSION_ID,r),x.set(this.SESSION_EXPIRES,+a)),this._initPrompt(),this._nudge&&Ot(y,()=>{kt(E,()=>{window.initNudge(this._campaignId)})}),this._textUs&&Ot(S,()=>{kt(v,()=>{window.initTextUs(this._campaignId)})}),et(this._config.campaign_id,this._sessionId),this._modal.load({loadCallback:this._loadModalCallback.bind(this),openCallback:this._openModalCallback.bind(this),closeCallback:this._closeModalCallback.bind(this)})};this._sleepSchedule?this._checkSleepTimeSchedule((e,o)=>{e&&console.error(e),t(o)}):t(!1)}_restart(){this._restarting=!0;let t=document.getElementById("rp-modal-content");B.set(this.INITIAL_MESSAGE_POSTED,!1),this._getIFrameUrl(e=>{t.innerHTML=`<iframe role="presentation" id="respagebot" title="Respage bot iFrame" src="${e}"></iframe>`,yt({event:"resbotOpen"})})}_checkSleepTimeSchedule(t){if(!this._config.on_off_schedule)return t(null,!1);return P({method:"POST",url:this._botServerUrl+"api/sleep-info",json:!0,body:{time_zone:this._config.campaign_timezone,on_off_schedule:JSON.stringify(this._config.on_off_schedule)},onSuccess:e=>{t(null,e.sleep_time)},onError:e=>{I&&console.log("[RESBOT] Error accessing api/sleep-info",e),t(null,!1)}})}_getIFrame(){if(this._respageBotIframe)return this._respageBotIframe;const t=document.getElementById("respagebot");return this._respageBotIframe=t,t}_getIFrameUrl(t){var e,o,n;let i=B.get(this.CHATBOT_SETTING),s=x.get(this.SESSION_ID),r=!x.get(this.SESSION_EXPIRES)||lt(x.get(this.SESSION_EXPIRES)),a=[];const l=Ct(this._config,Tt.Chatbot),c=Ct(this._config,Tt.AmenityBooking);let d=this._botUrl+"?c="+this._campaignId+"&bl="+(window[z]||"property_site")+"&l="+this._locale+"&DEBUG="+I+"&brand="+encodeURIComponent(this._config.bot_button_color)+"&utm="+encodeURIComponent(JSON.stringify((t=>{if(!t)return null;const e=["utm_source","utm_medium","utm_campaign","utm_term","utm_content"],o={};let n=!1;for(const i of e){const e=new RegExp(i+"=(.*?)(?:&|$)").exec(t);n||(n=!!e&&!!e[1]),o[i]=e&&e[1]}return n?o:null})(window.location.search)))+"&rcstdid="+encodeURIComponent(((t,e)=>{if(!t)return null;const o=new RegExp(e+"=(.*?)(?:&|$)").exec(t);return null===o?null:o[1]})(window.location.search,"rcstdid"))+"&is_mobile="+(!!L()).toString()+"&themePrimary="+encodeURIComponent((null===(e=this._config)||void 0===e?void 0:e.bot_button_color)||"")+"&themeAccent="+encodeURIComponent((null===(o=this._config)||void 0===o?void 0:o.bot_button_accent_color)||"")+"&optInCtaText="+encodeURIComponent((null===(n=this._config)||void 0===n?void 0:n.opt_in_cta_text)||"");var _;l&&!window[F]&&(d+="&b="+this._config.bot_name+"&bi="+this._config.bot_avatar_url+Bt(this._config)+"&es="+i.bot_enable_spanish+"&pc="+(_=this._campaignId,(+B.get(_+"resbot_nudgeCount")||0)+"&bt=")+this._config.bot_button_contact_submit_type+"&ca="+Pt(this._config)+"&hh="+(this._config.human_handoff?this._config.human_handoff:"false")+"&oq="+this._config.override_initial_quick_replies+"&hrb="+this._config.hide_resident_button,a.push("chatbot")),(c||window[F])&&a.push("amenity_booking"),d+="&modes="+a.join(","),window[H]&&(d+="&rid="+window[H]),window[G]&&(d+="&ue="+window[G]),window[J]&&(d+="&up="+window[J]),window[$]&&(d+="&pd="+window[$]);let h=B.get(this.INITIAL_MESSAGE_POSTED);"true"===h&&(d+="&im="+h),this._experiment&&(d+="&ex="+this._experiment),dt()&&(d+="&nc=true");let u=window&&window.hyAM&&window.hyAM._ds&&window.hyAM._ds&&window.hyAM._ds.ssid;if(u&&(I&&console.log("[RESBOT][INIT] hy.ly session id found: "+u),d+="&hl="+u),!s||r)return I&&console.log("[RESBOT][INIT] Token is missing"),void xt.call(this,t,d,{conversationId:Nt(20)});I&&console.log("[RESBOT][INIT] Token is valid"),this._sessionId=s,d+="&s="+s,d+="&reconnect=true",t(d)}_loadModalCallback(){let t=document.getElementsByClassName("chatprompt")[0],e=B.get(this.DID_OPEN),o=B.get(this.IS_OPEN);t.style.display="block";const n=Ct(this._config,Tt.AmenityBooking);if(window.respage_post_message=this._postMessageToBot.bind(this),n&&(window.respage_amenity_booking_open=()=>{this._postMessageToBot(void 0,"resbotOpenAmenityBooking")}),o)return this._modal.open();if(!e&&!L()&&this._config.bot_selfstart){const t=function(t){var e;if(!performance.mark||!performance.getEntries)return t;if(performance.mark("resbot_botInitMeasureEnd"),!t)return 0;const o=(null===(e=null===performance||void 0===performance?void 0:performance.getEntriesByType("navigation"))||void 0===e?void 0:e[0]).loadEventEnd,n=o+performance.measure("botInitMeasure","resbot_botInitMeasureStart","resbot_botInitMeasureEnd").duration,i=1e3*+t;if(o>2e3&&console.warn(`rp-loader: load event took longer than expected (${Math.floor(o)}ms)`),n>3e3)return console.warn("rp-loader: load event took too long. disabling self-start."),-1;const s=i-n>0?i-n:0;return I&&(console.log(`rp-loader: already waited for ${Math.floor(n)} milliseconds for initialization`),console.log(`rp-loader: waiting for ${s} more milliseconds before opening`)),s}(this._config.bot_selfstart_timeout);t>-1&&setTimeout(()=>{e=B.get(this.DID_OPEN),o=B.get(this.IS_OPEN),o||this._modal.open()},t)}window[j]=!0}_openModalCallback(){this._getIFrame()||this._getIFrameUrl(t=>{this._modal.appendModalContent(`<iframe role="presentation" id="respagebot" title="Respage bot iFrame" src="${t}"></iframe>`),yt({event:"resbotOpen"})})}_closeModalCallback(){yt({event:"resbotClose"})}_initPrompt(){const t=this._getMode();this._config.custom_css&&Rt(this._config.custom_css);const e=((t,e="chatbot")=>{if(!document.querySelectorAll(".chatprompt").length){let o=t.bot_icon_url;o||Rt(`\n                .rpBotIcon--fill-primary {fill: ${t.bot_button_color||"#4b80c2"} !important; }\n                .rpBotIcon--fill-accent {fill: ${t.bot_button_accent_color||"#797878"}  !important }\n            `);const n=o?`<img width="100" height="100" loading="lazy" aria-hidden="true" alt="Open Webchat" src="${o}" />`:'\n<svg id="rp-bot-icon" xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 484 484">\n  <defs>\n    <style>\n      .rpBotIcon__shadow {\n        fill: #231f20;\n        opacity: 0.25;\n      }\n\n      .rpBotIcon--fill-white {\n        fill: #fff;\n      }\n\n      .rpBotIcon--translucent {\n        opacity: 0.5;\n      }\n    </style>\n  </defs>\n  <circle id="rp-bot-icon" class="rpBotIcon--fill-primary rpBotIcon--translucent" cx="242" cy="242" r="242"/>\n  <path id="rp-bot-icon__bubble-bottom__shadow" class="rpBotIcon__shadow" d="M281.88,232.8h75.24l1.51,0v0c22.48,0,38.84,12.78,45.3,19.62h0a63.13,63.13,0,0,1,16.58,43.28c0,.17,0,.33,0,.5h0c-1.78,19-5.24,24.09-12,33.65s-47.63,48-47.63,48c0-3.92-.13-10.35-.25-18.36-1.17.07-2.36.1-3.55.1H281.88a63.57,63.57,0,0,1-63.39-63.39h0A63.58,63.58,0,0,1,281.88,232.8Z" transform="translate(0 1)"/>\n  <path id="rp-bot-icon__bubble-bottom__bg" class="rpBotIcon--fill-accent" d="M281.88,227.49h75.24l1.51,0v0c22.48,0,38.84,12.77,45.3,19.61h0a63.16,63.16,0,0,1,16.58,43.29c0,.16,0,.33,0,.49h0c0,21.48-12.38,37.52-27.29,52l-32.31,29.62c0-3.92-.13-10.34-.25-18.35-1.17.06-2.36.1-3.55.1H281.88a63.58,63.58,0,0,1-63.39-63.4h0A63.58,63.58,0,0,1,281.88,227.49Z" transform="translate(0 1)"/>\n  <circle id="rp-bot-icon__bubble-bottom__dot-1" class="rpBotIcon--fill-white rpBotIcon--translucent" cx="360.63" cy="290.76" r="12.74"/>\n  <circle id="rp-bot-icon__bubble-bottom__dot-2" class="rpBotIcon--fill-white rpBotIcon--translucent" cx="322.52" cy="290.76" r="12.74"/>\n  <circle id="rp-bot-icon__bubble-bottom__dot-3" class="rpBotIcon--fill-white rpBotIcon--translucent" cx="285.57" cy="290.76" r="12.74"/>\n  <path id="rp-bot-icon__bubble-top__shadow" class="rpBotIcon__shadow" d="M279.59,128.61H164l-2.31,0v0c-34.54,0-59.66,19.62-69.58,30.13h0a96.94,96.94,0,0,0-25.47,66.47c0,.26,0,.51,0,.77h0c0,33,91.55,125.4,91.55,125.4.06-6,.19-15.88.37-28.19,1.8.1,3.62.16,5.45.16H279.59c53.56,0,97.37-43.82,97.37-97.37h0C377,172.43,333.15,128.61,279.59,128.61Z" transform="translate(0 1)"/>\n  <path id="rp-bot-icon__bubble-top__bg" class="rpBotIcon--fill-white" d="M272.94,121H157.38q-1.15,0-2.31,0v0c-34.54,0-59.67,19.62-69.58,30.13h0A96.94,96.94,0,0,0,60,217.56c0,.26,0,.51,0,.77h0c0,33,19,57.62,41.91,79.9l49.63,45.5c.07-6,.2-15.88.38-28.19,1.8.1,3.62.16,5.45.16H272.94c53.56,0,97.37-43.82,97.37-97.37h0C370.31,164.78,326.5,121,272.94,121Z" transform="translate(0 1)"/>\n  <circle id="rp-bot-icon__bubble-top__dot-1" class="rpBotIcon--fill-accent" cx="152" cy="217.61" r="19.56"/>\n  <circle id="rp-bot-icon__bubble-top__dot-2" class="rpBotIcon--fill-accent" data-name="rp-bot-icon__bubble-top__dot" cx="210.53" cy="217.61" r="19.56"/>\n  <circle id="rp-bot-icon__bubble-top__dot-3" class="rpBotIcon--fill-accent" data-name="rp-bot-icon__bubble-top__dot" cx="267.28" cy="217.61" r="19.56"/>\n</svg>';let i=document.createElement("div");return i.className="chatprompt",i.innerHTML="chatbot"===e?n:'<div style="padding: 1em; color:white; font-family: sans-serif; background-color: '+t.bot_button_color+';border-radius: 0.5em; box-shadow: 1px 1px 2px rgba(0,0,0,0.3)">Resident Amenity Booking</div>',i.setAttribute("aria-label","Open Chatbot"),i.setAttribute("role","button"),i.setAttribute("aria-expanded",""+!1),i.setAttribute("tabindex","0"),document.body.appendChild(i),i}})(this._config,t);e.addEventListener("click",()=>{this._modal.open(this._campaignId),window[q]||this._trackEvent("user_opened_bot","interaction")}),e.addEventListener("keyup",t=>{"Enter"!==t.code&&"Space"!==t.code||(this._modal.open(this._campaignId),window[q]||this._trackEvent("user_opened_bot","interaction"))})}_eventResbotSessionExpired(){I&&console.log("[RESBOT][EVENT] Session expired event triggered. Reloading Frame"),x.set(this.OLD_SESSION_ID,x.get(this.SESSION_ID)),x.set(this.SESSION_ID,""),this._sessionId=null,this._restart()}_eventResbotMessage(t){this._restarting&&t&&t.message&&(this._storedMessage&&yt({event:"resbotSendMessage",message:this._storedMessage}),this._restarting=!1),t&&t.fromUser&&t.message&&(this._storedMessage=t.message),x.set(this.SESSION_EXPIRES,ct(240))}_eventResbotWaitingForAgent(){let t=B.get(this.CHATBOT_SETTING);if(!t.human_handoff_waiting_timeout||this._waitingTimeout)return;let e=60*t.human_handoff_waiting_timeout*1e3,o=x.get(this.WAITING_TIMEOUT_TIMESTAMP);o?e-=Date.now()-o:x.set(this.WAITING_TIMEOUT_TIMESTAMP,Date.now()),this._waitingTimeout=setTimeout(()=>{yt({event:"resbotWaitingTimeout",info:{conversation_id:x.get(this.SESSION_ID),campaign_id:t.campaign_id,client_id:t.client_id}}),x.remove(this.WAITING_TIMEOUT_TIMESTAMP),this._waitingTimeout=null},e)}_eventResbotConnectedToAgent(){this._agentConnected=!0,clearTimeout(this._waitingTimeout),this._waitingTimeout=null,x.remove(this.WAITING_TIMEOUT_TIMESTAMP)}_eventResbotConnectedToBot(){this._agentConnected=!1}_eventResbotInitialized(t){I&&console.log("[RESBOT][EVENT] Client received init event"),t&&t.detail&&(this._sessionId=t.detail,x.set(this.SESSION_ID,this._sessionId),x.set(this.SESSION_EXPIRES,ct(240)))}_eventAppBootstrapped(){I&&console.log("[RESBOT][EVENT] Angular App Finished Bootstrapping"),this._initialized=!0,this._config.custom_css&&yt({event:"resbotCustomCss",value:this._config.custom_css})}_eventResbotCustomButton(t){switch(t.type){case d:((t,e=null)=>{switch(t){case s:window.knockDoorway?(u("utm_knock","chb"),p(),window.knockDoorway.openScheduling()):console.error("No scheduling integration found on page");break;case r:window.knockDoorway?(u("utm_knock","chb"),p(),window.knockDoorway.openAvailabilities()):console.error("No availability integration found on page");break;case a:window.knockDoorway?(u("utm_knock","chb"),p(),window.knockDoorway.openTextWithUs()):console.error("No texting integration found on page");break;case l:let t=window.document.querySelector('.grid-item[data-name="'+e+'"]');t||(t=window.document.querySelector('.grid-item[data-name="'+e.toLowerCase()+'"]')),t&&t.firstChild&&t.firstChild.click()}})(t.value,t.data);break;case c:window.open(t.value,"_blank");break;case _:document.querySelector(t.value).click()}}_eventResbotInitialMessagePosted(t){B.set(this.INITIAL_MESSAGE_POSTED,t.value)}_trackEvent(t,e){yt({event:"resbotTrackEvent",detail:{action:t,event_category:e}})}_prependCampaignId(t){return this._campaignId+"~"+t}_eventResbotSendGoogleAnalyticsEvent(t){if(!(t&&t.action&&t.event_category&&t.event_label))return void console.log("[Respage Chatbot] Missing GA event details. Details: "+JSON.stringify(t));if(!window.ga&&!window.gtag)return void console.log("[Respage Chatbot] Could not find Google Tag Manager or Google Analytics.");const e=Object.assign({},t);if(e.event_category="respage_"+e.event_category,e.action="chatbot_"+e.action,window.gtag&&(window.gtag("event",e.action,e),console.log("[Respage Chatbot] Sent GA event through gtag.")),window.ga){let t={hitType:"event",eventCategory:e.event_category,eventAction:e.action,eventLabel:e.event_label,eventValue:e.value},o=window.ga.getAll&&window.ga.getAll();if(o&&o.length)for(let e=0;e<o.length;e++)o[e].send&&(o[e].send(t),console.log("[Respage Chatbot] Sent GA event through tracker: "+o[e].get("trackingId")));else window.ga("send",t),console.log("[Respage Chatbot] Sent GA event through ga.")}}_eventResbotOpenModal(){this._modal.open(!0)}_getMode(){const t=Ct(this._config,Tt.Chatbot)&&!window[F],e=Ct(this._config,Tt.AmenityBooking);return t?"chatbot":e?"amenities":void 0}_postMessageToBot(t="",e="resbotSendMessage"){B.get(this.IS_OPEN)||this._modal.open();const o=setInterval(()=>{this._initialized&&(yt({event:e,message:t}),clearInterval(o))},100)}}const xt=function(t,e,o){return I&&console.log("[RESBOT][TOKEN_GEN] Successfully generated a new token"),e+="&s="+o.conversationId,this._sessionId=o.conversationId,t(e)},Bt=function(t){if(!t.custom_buttons||!t.custom_buttons.length)return"";let e=t.custom_buttons.filter(t=>t.display_type===h);return 0===e.length?"":"&cb="+encodeURIComponent(JSON.stringify(e))},Pt=function(t){if(!t.custom_announcement||!t.custom_announcement.strings_to_match||!t.custom_announcement.strings_to_match)return"";let e=t.custom_announcement.strings_to_match.split(",");if(!e)return"";let o=[t.custom_announcement.bg_color||"",t.custom_announcement.title||"",e[0].trim()||""];return encodeURIComponent(o.join("~"))};class Ut{}Ut.avatar_url=O+"/api/review-solicitation/avatar",Ut.app_url=k,Ut.review_bot_setting="resbot_reviewBotSetting";const Dt=t=>{try{let e=null==t?void 0:t.split("?")[0];if(!e)return;const o=e.split("-");return e=o[o.length-1],e}catch(t){return}},Lt=t=>{let e="",o="",n="";if(window.location.href.includes("respage_ils_external_id")&&(o=new URLSearchParams(window.location.search).get("respage_ils_external_id").split("?")[0],e="external_id.rent_id"),window.location.href.includes("respage_ils_name")&&(n=new URLSearchParams(window.location.search).get("respage_ils_name").split("?")[0]),!o){const i=(t=>{let e="";switch(null==t?void 0:t.split("/").filter(t=>t.includes(".com"))[0]){case"www.rent.com":if(e=Dt(t),!e)return;return{external_id:e,ils_name:"rentpath"};case"www.qa.rent.com":case"qa.rent.com":if(e=Dt(t),!e)return;return{external_id:e,ils_name:"rentpath-qa"};default:return}})(window.location.href.split("?")[0]);if(!i)return Promise.resolve({campaignId:t});o=i.external_id,e="external_id.rent_id",n=i.ils_name}return D(`ILS-campaign-ID-${o}-${n}`,{method:"GET",url:`${f}public/chatbot/campaigns/matchByClient?searchFor=${e}&searchValue=${o}${n?"&ilsName="+n:""}`,json:!0}).then(t=>(I&&console.log("got settings from remote",t),t&&B.set(`ILS-campaign-ID-${o}-${n}`,t))).catch(t=>(t.name="ILS-campaign-ID: Chatbot Settings Error",console.log(t),null))},jt={chatbot:!0,textUs:!0,nudge:!0,reviewbot:!0,sleepSchedule:!1},qt=(t,e)=>{setTimeout(()=>{var o;if(!t)throw new Error("rp-loader fatal error: initialized without campaignId");(null===(o=Object.values(e))||void 0===o?void 0:o.length)||console.warn("rp-loader: no enabled features"),Lt(t).then(e=>{t=e.campaignId}).finally(()=>{B.set("resbot_campaignId",t),At(t).then(o=>{if(!o)throw new Error("rp-loader fatal error: unable to get settings");const n=Ct(o,Tt.Chatbot),i=Ct(o,Tt.AmenityBooking);if(e.chatbot&&(n||i))if(o.noEmbed)console.warn("rp-loader: chatbot no embed");else{new Mt(t,Object.assign(Object.assign({},e),{reviewbot:!1})).load()}e.reviewbot&&Ct(o,Tt.ReviewBot)&&(t=>{try{const e=B.get(`${t}~${Ut.review_bot_setting}`);return e?(console.log("got settings from cache",e),Promise.resolve(e)):U({method:"GET",url:b+t+"~settings",json:!0}).then(e=>(I&&console.log("got settings from remote",e),e&&B.set(`${t}~${Ut.review_bot_setting}`,e)))}catch(e){return e.name=t+": Reviewbot Settings Error",console.error(e),null}})(t).then(e=>{e.noEmbed?console.warn("rp-loader: reviewbot no embed"):(Ot(T),kt(C,()=>{window.respageSolicitor_Load(t)}))})})})},50)};window.respageBot_Load=(t,e,o)=>{qt(t,jt)},window.respageInit=(t,e)=>{qt(t,e)}}]);